<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Dashboard - ENTHUSIASM 1.0</title>
Â  <link rel="stylesheet" href="css/style.css">
</head>
<body>
Â  <div class="container">
Â  Â  <h1>Welcome, <%= student.fullName %></h1>
Â  Â  <p>Email: <%= maskedEmail %></p>
Â  Â  <p>Attendance Score: <%= student.attendance %>/<%= student.totalClasses %></p>
Â  Â  <div class="progress-bar">
Â  Â  Â  <div style="width: <%= student.progress %>%"><%= student.progress %>%</div>
Â  Â  </div>

Â  Â  <h2>Community Support</h2>
Â  Â  <p class="community-support"><a href="https://chat.whatsapp.com/Ll4okZM3hl1ET7lqxtuXyw" target="_blank">WhatsApp Group link</a></p>

Â  Â  <h2>My Registered Courses</h2>
Â  Â  <ul>
Â  Â  Â  <% student.courses.forEach(course => { %>
Â  Â  Â  Â  <li><%= course %></li>
Â  Â  Â  <% }); %>
Â  Â  </ul>

Â  Â  <h2>Assignments</h2>
Â  Â  <% student.courses.forEach(course => { %>
Â  Â  Â  <h3><%= course %></h3>
Â  Â  Â  <ul>
Â  Â  Â  Â  <% const assignment = student.assignments.find(a => a.course === course); %>
Â  Â  Â  Â  <% if (assignment && assignment.submissions && assignment.submissions.length > 0) { %>
Â  Â  Â  Â  Â  <% assignment.submissions.forEach(submission => { %>
Â  Â  Â  Â  Â  Â  <li>
Â  Â  Â  Â  Â  Â  Â  <a href="<%= submission.filePath.replace('public/', '') %>" target="_blank">View Submission</a>Â 
Â  Â  Â  Â  Â  Â  Â  - Status: <strong><%= submission.status %></strong>
Â  Â  Â  Â  Â  Â  </li>
Â  Â  Â  Â  Â  <% }); %>
Â  Â  Â  Â  <% } else { %>
Â  Â  Â  Â  Â  <li>No assignments submitted for this course.</li>
Â  Â  Â  Â  <% } %>
Â  Â  Â  </ul>
Â  Â  <% }); %>

Â  Â  <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 20px;">
Â  Â  Â  <form action="/upload-assignment?token=<%= token %>" method="POST" enctype="multipart/form-data">
Â  Â  Â  Â  <label for="course">Select Course to Upload:</label>
Â  Â  Â  Â  <select name="course" id="course" required>
Â  Â  Â  Â  Â  <% student.courses.forEach(course => { %>
Â  Â  Â  Â  Â  Â  <option value="<%= course %>"><%= course %></option>
Â  Â  Â  Â  Â  <% }); %>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <input type="file" name="assignment" accept=".pdf,.jpg,.png" required>
Â  Â  Â  Â  <button type="submit">Upload Assignment</button>
Â  Â  Â  Â  <div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; border: 1px solid #ffeeba; margin-top: 10px;">
Â  Â  Â  Â  Â  <strong>âš ï¸ Submission Policy:</strong> Ensure you are uploading the correct file.Â 
Â  Â  Â  Â  Â  Incorrect submissions will be deleted by the admin.
Â  Â  Â  Â  </div>
Â  Â  Â  </form>
Â  Â  </div>

Â  Â  <h2>Class Link</h2>
Â  Â  <div style="margin-top: 15px;">
Â  Â  Â  <form action="/join-class?token=<%= token %>" method="POST">

Â  Â  Â  Â  <button type="submit">Join Live Class</button>
<div style="background-color: #fff3cd; color: #856404; padding: 15px; border-radius: 5px; border: 1px solid #ffeeba; margin-bottom: 15px;">
   <strong>ğŸ“¢ Live Session is Active:</strong> Click below to enter the virtual classroom. Please keep your microphone muted upon entry 
    and use the <strong>"Raise Hand"</strong> feature for questions. Letâ€™s create greatness together.
</div>
Â  Â  Â  </form>
Â  Â  </div>

Â  Â  <div style="margin-top: 25px;">
Â  Â  Â  <h2>Attendance</h2>
Â  Â  Â  <%Â 
Â  Â  Â  Â  const today = new Date();
Â  Â  Â  Â  const alreadyMarkedToday = student.attendanceDates && student.attendanceDates.some(date => {
Â  Â  Â  Â  Â  return new Date(date).toDateString() === today.toDateString();
Â  Â  Â  Â  });

Â  Â  Â  Â  const weekStart = new Date(today);
Â  Â  Â  Â  weekStart.setDate(today.getDate() - today.getDay() + 1);Â 
Â  Â  Â  Â  const weeklyCount = student.attendanceDates ? student.attendanceDates.filter(date => {
Â  Â  Â  Â  Â  return new Date(date) >= weekStart;
Â  Â  Â  Â  }).length : 0;
Â  Â  Â  %>

Â  Â  Â  <% if (alreadyMarkedToday) { %>
Â  Â  Â  Â  <p>âœ… You have already marked attendance today.</p>
Â  Â  Â  <% } else if (weeklyCount >= 5) { %>
Â  Â  Â  Â  <p>ğŸš« Weekly limit reached.</p>
Â  Â  Â  <% } else { %>
Â  Â  Â  Â  <form action="/mark-attendance?token=<%= token %>" method="POST">
Â  Â  Â  Â  Â  <button type="submit">Mark Attendance for Today</button>
Â  Â  Â  Â  </form>
Â  Â  Â  <% } %>
Â  Â  </div>

Â  Â  <div style="margin-top: 30px; border-top: 1px solid #ddd; padding-top: 10px;">
Â  Â  Â  <form action="/logout" method="POST">
Â  Â  Â  Â  <button type="submit" style="background-color: #ff4444; color: white;">Logout</button>
Â  Â  Â  </form>
Â  Â  </div>
Â  </div> <script src="js/script.js"></script>
Â  <script>
Â  Â  const urlParams = new URLSearchParams(window.location.search);
Â  Â  const token = urlParams.get('token');
Â  Â  if (token) { localStorage.setItem('jwtToken', token); }
Â  </script>
</body>
</html>
